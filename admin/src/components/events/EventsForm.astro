<!-- Modal toggle -->
<button
    data-modal-target="default-modal"
    data-modal-toggle="default-modal"
    class="text-white bg-brand box-border border border-transparent hover:bg-brand-strong focus:ring-4 focus:ring-brand-medium shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none mr-10"
    type="button"
>
    +
</button>

<!-- Main modal -->
<div
    id="default-modal"
    tabindex="-1"
    aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
>
    <div class="relative p-4 w-full max-w-2xl max-h-full">
        <!-- Modal content -->
        <div
            class="relative bg-neutral-primary-soft border border-default rounded-base shadow-sm p-4 md:p-6"
        >
            <!-- Modal header -->
            <div
                class="flex items-center justify-between border-b border-default pb-4 md:pb-5"
            >
                <h3 class="text-lg font-medium text-heading">
                    Crear un evento nuevo
                </h3>
                <button
                    type="button"
                    class="text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-9 h-9 ms-auto inline-flex justify-center items-center"
                    data-modal-hide="default-modal"
                >
                    <svg
                        class="w-5 h-5"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        fill="none"
                        viewBox="0 0 24 24"
                        ><path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18 17.94 6M18 18 6.06 6"></path></svg
                    >
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="space-y-4 md:space-y-6 py-4 md:py-6">
                <div class="flex flex-col w-full m-auto" id="formEvent">
                    <label for="title">Titulo</label>
                    <input
                        type="text"
                        name="title"
                        id="etitle"
                        placeholder="Título"
                        class="block px-3 py-2.5 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand shadow-xs placeholder:text-body"
                    />
                    <label for="image">Imagen</label>
                    <input
                        type="text"
                        name="image"
                        id="eimage"
                        placeholder="Url"
                        class="block px-3 py-2.5 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand shadow-xs placeholder:text-body"
                    />
                    <label for="price">Precio</label>
                    <input
                        type="number"
                        name="price"
                        id="eprice"
                        placeholder="0.0"
                        class="block px-3 py-2.5 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand shadow-xs placeholder:text-body"
                    />
                    <label for="stock">Aforo</label>
                    <input
                        type="number"
                        name="stock"
                        id="estock"
                        placeholder="0"
                        class="block px-3 py-2.5 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand shadow-xs placeholder:text-body"
                    />
                    <label for="date">Fecha</label>
                    <input type="date" name="date" id="edate" class="block px-3 py-2.5 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand shadow-xs placeholder:text-body"/>                    
                    <div class="w-full flex">
                        <div class="flex justify-between w-full gap-4">
                            <div class="flex flex-col">
                                <label for="ecordsx">Coordenadas X</label>
                                <input type="number" name="ecordsx" id="ecordsx" class="block px-3 py-2.5 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand shadow-xs placeholder:text-body"/>
                            </div>
                            <div class="flex flex-col">
                                <label for="ecordsy">Coordenadas Y</label>
                                <input type="number" name="ecordsy" id="ecordsy" class="block px-3 py-2.5 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand shadow-xs placeholder:text-body"/>
                            </div>
                        </div>
                    </div>
                    <label for="desc">Description</label>
                    <textarea
                        name="desc"
                        id="edesc"
                        placeholder="Descripción"
                        class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block p-3.5 shadow-xs placeholder:text-body"
                    ></textarea>
                    <button
                        id="addEvent"
                        class="mt-[1rem] text-white bg-success box-border border border-transparent hover:bg-success-strong focus:ring-4 focus:ring-success-medium shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none"
                        >+</button
                    >
                </div>
            </div>
        </div>
        <!-- Modal footer
            <div class="flex items-center border-t border-default space-x-4 pt-4 md:pt-5">
                <button data-modal-hide="default-modal" type="button" class="text-white bg-brand box-border border border-transparent hover:bg-brand-strong focus:ring-4 focus:ring-brand-medium shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">I accept</button>
                <button data-modal-hide="default-modal" type="button" class="text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">Decline</button>
            </div>
             -->
    </div>
</div>
<script>
    import { Compresor } from "../../db/compresor";
    import { DataBase } from "../../db/db";
    const db = new DataBase();
    const compresor = new Compresor();
    document.getElementById("addEvent")?.addEventListener("click", async () => {
        const formImage = document.getElementById("formEvent");
        compresor
            .getImage(formImage?.querySelector("#eimage")?.value)
            .then((response) => response.blob())
            .then((blob) => {
                compresor.zipImage(blob).then(async (zipped) => {
                    //aquí irá el código para subir la imagen a un servidor y obtener la url
                    compresor.makeBase64(zipped).then((base64) => {
                        const formValues = {
                            title: formImage?.querySelector("#etitle")?.value,
                            price: parseFloat(
                                formImage?.querySelector("#eprice")?.value,
                            ),
                            stock: parseInt(
                                formImage?.querySelector("#estock")?.value,
                            ),
                            date: formImage?.querySelector("#edate")?.value,
                            coords: {
                                x: parseFloat(
                                    formImage?.querySelector("#ecordsx")
                                        ?.value,
                                ),
                                y: parseFloat(
                                    formImage?.querySelector("#ecordsy")
                                        ?.value,
                                ),
                            },
                            image: base64,
                            desc: formImage?.querySelector("#edesc")?.value,
                        };
                        //posteriormente irá en el writeAsync una mierda que permita llevar la info al socket
                        db.writeAsync("events", formValues, () => {
                            globalThis['worker'].postMessage({
                                action: "updateevents",
                                data: formValues,
                            });
                            readData();
                        });
                    });
                });
            });
    });
</script>